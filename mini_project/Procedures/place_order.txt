CREATE OR REPLACE PROCEDURE PLACE_ORDER(P_CUST_MOBILE ORDERS.CUST_MOBILE%TYPE,
										P_RES_ID ORDERS.RES_ID%TYPE,
										P_ITEM_NAME ORDERS.ITEM_NAME%TYPE,
										P_QTY ORDERS.QTY%TYPE) IS
	CURSOR CUR_ITEM_DETAILS IS SELECT * FROM MENU WHERE RES_ID=P_RES_ID AND ITEM_NAME=P_ITEM_NAME;
	V_QTY_AVL MENU.QTY_AVL%TYPE;
	V_ITEM_ROW CUR_ITEM_DETAILS%ROWTYPE;
	V_NEXT_ORDNO ORDERS.ORD_NO%TYPE;
BEGIN
	OPEN CUR_ITEM_DETAILS;
	FETCH CUR_ITEM_DETAILS INTO V_ITEM_ROW;
	IF V_ITEM_ROW.QTY_AVL-P_QTY<0 THEN
		DBMS_OUTPUT.PUT_LINE('ITEMS QUANTITY UNAVAILABLE');
		DBMS_OUTPUT.PUT_LINE('NO OF ITEMS PRESENT: '||V_ITEM_ROW.QTY_AVL);
	ELSIF V_ITEM_ROW.QTY_AVL-P_QTY>=0 THEN
		UPDATE MENU
		SET QTY_AVL=QTY_AVL-P_QTY
		WHERE RES_ID=P_RES_ID AND ITEM_NAME=P_ITEM_NAME;
		SELECT MAX(ORD_NO) + 1 INTO V_NEXT_ORDNO FROM ORDERS;
		INSERT INTO ORDERS
		VALUES(V_NEXT_ORDNO,P_RES_ID,P_CUST_MOBILE,P_ITEM_NAME,P_QTY,'PENDING','PENDING');
		COMMIT;
		DBMS_OUTPUT.PUT_LINE('=====================B I L L=========================');
		DBMS_OUTPUT.NEW_LINE;
		DBMS_OUTPUT.PUT_LINE('                  ORDER PLACED');
		DBMS_OUTPUT.PUT_LINE('ORDER NO: '||LPAD(V_NEXT_ORDNO,43,'-'));
		DBMS_OUTPUT.PUT_LINE('RESTAURANT ID: '||LPAD(P_RES_ID,38,'-'));
		DBMS_OUTPUT.PUT_LINE('ITEM NAME: '||LPAD(P_ITEM_NAME,42,'-'));
		DBMS_OUTPUT.PUT_LINE('QUANTITY: '||LPAD(P_QTY,43,'-'));
		DBMS_OUTPUT.PUT_LINE('ORDER AMOUNT: Rs. '||LPAD(P_QTY*V_ITEM_ROW.ITEM_COST,35,'-'));
		DBMS_OUTPUT.PUT_LINE('PAYMENT STATUS:'|| LPAD('PENDING',38,'-'));
		DBMS_OUTPUT.PUT_LINE('DELIVERY STATUS:'|| LPAD('PENDING',37,'-'));
		DBMS_OUTPUT.PUT_LINE('FOR PAYMENT PLEASE WRITE:');
		DBMS_OUTPUT.PUT_LINE('EXEC PAYMENT(<YOUR ORDNO>,<AMOUNT>,<MODE OF PAYMENT>)');
	END IF;
	SELECT QTY_AVL INTO V_QTY_AVL FROM MENU WHERE RES_ID=P_RES_ID AND ITEM_NAME=P_ITEM_NAME;
	IF V_QTY_AVL=0 THEN
	UPDATE MENU
	SET STATUS = 'UNAVAILABLE'
	WHERE RES_ID=P_RES_ID AND ITEM_NAME=P_ITEM_NAME;
	END IF;
	CLOSE CUR_ITEM_DETAILS;
EXCEPTION
	WHEN OTHERS THEN
		DBMS_OUTPUT.PUT_LINE('WRONG DATA ENTERED. PLEASE TRY AGAIN');
END PLACE_ORDER;